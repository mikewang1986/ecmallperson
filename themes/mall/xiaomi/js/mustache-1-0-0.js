/*!
 * @version 1-0-0
 * @onlineVersion : 1-0-0
 */(function(a,b){if(typeof exports=="object"&&exports)b(exports);else{var c={};b(c),typeof define=="function"&&define.amd?define(c):a.KISSY?KISSY.add("mustache",function(a){a.mustache=c}):a.Mustache=c}})(this,function(a){function c(a,c){return b.call(a,c)}function e(a){return!c(d,a)}function h(a){return typeof a=="function"}function i(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function k(a){return String(a).replace(/[&<>"'\/]/g,function(a){return j[a]})}function l(a){if(!g(a)||a.length!==2)throw new Error("Invalid tags: "+a);return[new RegExp(i(a[0])+"\\s*"),new RegExp("\\s*"+i(a[1]))]}function r(b,c){function v(){if(k&&!r)while(j.length)delete h[j.pop()];else j=[];k=!1,r=!1}c=c||a.tags,b=b||"",typeof c=="string"&&(c=c.split(n));var d=l(c),f=new u(b),g=[],h=[],j=[],k=!1,r=!1,w,x,y,z,A,B;while(!f.eos()){w=f.pos,y=f.scanUntil(d[0]);if(y)for(var C=0,D=y.length;C<D;++C)z=y.charAt(C),e(z)?j.push(h.length):r=!0,h.push(["text",z,w,w+1]),w+=1,z==="\n"&&v();if(!f.scan(d[0]))break;k=!0,x=f.scan(q)||"name",f.scan(m),x==="="?(y=f.scanUntil(o),f.scan(o),f.scanUntil(d[1])):x==="{"?(y=f.scanUntil(new RegExp("\\s*"+i("}"+c[1]))),f.scan(p),f.scanUntil(d[1]),x="&"):y=f.scanUntil(d[1]);if(!f.scan(d[1]))throw new Error("Unclosed tag at "+f.pos);A=[x,y,w,f.pos],h.push(A);if(x==="#"||x==="^")g.push(A);else if(x==="/"){B=g.pop();if(!B)throw new Error('Unopened section "'+y+'" at '+w);if(B[1]!==y)throw new Error('Unclosed section "'+B[1]+'" at '+w)}else x==="name"||x==="{"||x==="&"?r=!0:x==="="&&(d=l(c=y.split(n)))}B=g.pop();if(B)throw new Error('Unclosed section "'+B[1]+'" at '+f.pos);return t(s(h))}function s(a){var b=[],c,d;for(var e=0,f=a.length;e<f;++e)c=a[e],c&&(c[0]==="text"&&d&&d[0]==="text"?(d[1]+=c[1],d[3]=c[3]):(b.push(c),d=c));return b}function t(a){var b=[],c=b,d=[],e,f;for(var g=0,h=a.length;g<h;++g){e=a[g];switch(e[0]){case"#":case"^":c.push(e),d.push(e),c=e[4]=[];break;case"/":f=d.pop(),f[5]=e[2],c=d.length>0?d[d.length-1][4]:b;break;default:c.push(e)}}return b}function u(a){this.string=a,this.tail=a,this.pos=0}function v(a,b){this.view=a==null?{}:a,this.cache={".":this.view},this.parent=b}function w(){this.cache={}}var b=RegExp.prototype.test,d=/\S/,f=Object.prototype.toString,g=Array.isArray||function(a){return f.call(a)==="[object Array]"},j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},m=/\s*/,n=/\s+/,o=/\s*=/,p=/\s*\}/,q=/#|\^|\/|>|\{|&|=|!/;u.prototype.eos=function(){return this.tail===""},u.prototype.scan=function(a){var b=this.tail.match(a);if(b&&b.index===0){var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,c}return""},u.prototype.scanUntil=function(a){var b=this.tail.search(a),c;switch(b){case-1:c=this.tail,this.tail="";break;case 0:c="";break;default:c=this.tail.substring(0,b),this.tail=this.tail.substring(b)}return this.pos+=c.length,c},v.prototype.push=function(a){return new v(a,this)},v.prototype.lookup=function(a){var b;if(a in this.cache)b=this.cache[a];else{var c=this;while(c){if(a.indexOf(".")>0){b=c.view;var d=a.split("."),e=0;while(b!=null&&e<d.length)b=b[d[e++]]}else b=c.view[a];if(b!=null)break;c=c.parent}this.cache[a]=b}return h(b)&&(b=b.call(this.view)),b},w.prototype.clearCache=function(){this.cache={}},w.prototype.parse=function(a,b){var c=this.cache,d=c[a];return d==null&&(d=c[a]=r(a,b)),d},w.prototype.render=function(a,b,c){var d=this.parse(a),e=b instanceof v?b:new v(b);return this.renderTokens(d,e,c,a)},w.prototype.renderTokens=function(b,c,d,e){function j(a){return i.render(a,c,d)}var f="",i=this,k,l;for(var m=0,n=b.length;m<n;++m){k=b[m];switch(k[0]){case"#":l=c.lookup(k[1]);if(!l)continue;if(g(l))for(var o=0,p=l.length;o<p;++o)f+=this.renderTokens(k[4],c.push(l[o]),d,e);else if(typeof l=="object"||typeof l=="string")f+=this.renderTokens(k[4],c.push(l),d,e);else if(h(l)){if(typeof e!="string")throw new Error("Cannot use higher-order sections without the original template");l=l.call(c.view,e.slice(k[3],k[5]),j),l!=null&&(f+=l)}else f+=this.renderTokens(k[4],c,d,e);break;case"^":l=c.lookup(k[1]);if(!l||g(l)&&l.length===0)f+=this.renderTokens(k[4],c,d,e);break;case">":if(!d)continue;l=h(d)?d(k[1]):d[k[1]],l!=null&&(f+=this.renderTokens(this.parse(l),c,d,l));break;case"&":l=c.lookup(k[1]),l!=null&&(f+=l);break;case"name":l=c.lookup(k[1]),l!=null&&(f+=a.escape(l));break;case"text":f+=k[1]}}return f},a.name="mustache.js",a.version="0.8.1",a.tags=["{{","}}"];var x=new w;a.clearCache=function(){return x.clearCache()},a.parse=function(a,b){return x.parse(a,b)},a.render=function(a,b,c){return x.render(a,b,c)},a.to_html=function(b,c,d,e){var f=a.render(b,c,d);if(!h(e))return f;e(f)},a.escape=k,a.Scanner=u,a.Context=v,a.Writer=w});